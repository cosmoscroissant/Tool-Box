# Tool Box
## Requirements
- Python 3.10+
- IDA 9.2

## Downloader
### Malware Sample Downloader
sample_downloader.py will log in to virus.exchange and download the malware samples that are shown on the web page. It will refresh every 15 seconds to check for new samples. Before running the script, please change these three values:
- `USERNAME = "your_username_here"`
- `PASSWORD = "your_password_here"`
- `DOWNLOAD_DIR = r"your_path_here"`

### How-To
`python3 sample_downloader.py`

## Generator
### Analysis Files Generator
analysis_files_generator.py uses IDA to generate .IDB and .ASM files. The sample files and analysis files are located in sample_path.
- `sample_path = r"your_path_here"`

### How-To
`python3 analysis_files_generator.py`

## Extractor
### IR Extractor
ida_ir_progress_extractor.ps1 runs under **Administrator mode in powershell**, it monitors the progress of analysis_files_generator.py.

ida_ir_extractor.py generates 3 files:
- IR for entire file into ir.txt
- IR with IDA default information into ir_with_idainfo.txt
- summary for duration time and success rate (of generating IR) into ir_summary.txt

f.y.i. 

1. Microcode is IR (Intermediate Representation) in IDA
- [IDA 7.1](https://docs.hex-rays.com/release-notes/7_1)
    - "With this version of IDA we publish the decompiler intermediate language: the microcode."
- [IDA 9.2 Spying on Decompiler Internals: The Hex-Rays Microcode Viewer](https://hex-rays.com/blog/spying-on-decompiler-internals-the-hex-rays-microcode-viewer)

2. Fix Execution Policy Error

If there is an error after executing ida_ir_progress_extractor.ps1, such as:

```
ida_ir_progress_extractor.ps1 cannot be loaded because running scripts isdisabled on this system.
For more information, see about_Execution_Policies at https:/go.microsoft.com/fwlink/?LinkID=135170.
```

You can fix it by setting the execution policy `Set-ExecutionPolicy RemoteSigned`. After execution, use `Set-ExecutionPolicy Restricted` to set the policy back to its default value. ([PowerShell says "execution of scripts is disabled on this system."](https://stackoverflow.com/questions/4037939/powershell-says-execution-of-scripts-is-disabled-on-this-system))

3. Warnings in ida_ir_extractor.py

The warnings appear because ida_* modules (ida_range, ida_kernwin, ida_hexrays, etc.) are part of IDA Pro's Python API and are only available when the script runs inside IDA Pro.

### How-To
`pip3 install python-idb`

`.\ida_ir_progress_extractor.ps1 <sample_name>`

or

`pip3 install python-idb`

`"C:\Program Files\IDA Professional 9.2\ida.exe" -L"ir_with_idainfo.txt" -A -S"ida_ir_extractor.py" "<sample_name>"`

## Analyzer
### pseudo-C
pseudo_C_analyzer.py is for organizing pseudo-C generated by IDA. It will look for a file named 0 (entry point), and start from there. It goes through each function and generate 4 files according to "lib.txt", which provides functions and non-function filters.
- "all_function.txt" for all functions mentioned in the provided codebase
- "missing_functions.txt" for later checkouts
- "organized_code.txt" for a clean, complete code output
- "flow_chart.tx"t for complete call graph to view function relationships

f.y.i. pseudo_C_analyzer.py will delete these 4 files before creating new ones.

### How-To
`python3 pseudo_C_analyzer.py <path>`

## Sniffer
### ASM Footprint
asm_footprint_sniffer.py generates report containing hashes of the files and IoCs.
- hashes: IDA generate hashes
- protocols_full: well formed URLs
- urls: malformed or partial URLs
- domains: standalone domain names without protocols
- files
    - executable: exe, dll, scr, pif, com
    - sript: bat, cmd, vbs, js, ps1, sh, php
    - archives: zip, rar, 7z, jar
- main_patterns: functions and variables names that includes "main"
- ssh_patterns: referenced SSH client
- openssh_full: catches identity spoofing (complete email address)
- operational_files: files that carried out the operation
- dependency_paths: dependency in used

f.y.i. lib.txt is for blacklisting URLs that are unrelated to samples, such as hex-rays.com.

### How-To
`python3 asm_footprint_sniffer.py <file_path> -o report.txt`

`python3 asm_footprint_sniffer.py <directory_path> -r -o report.txt`

`python3 asm_footprint_sniffer.py <file_path> -o report.json -f json`

`python3 asm_footprint_sniffer.py <directory_path> -r -o report.json -f json`